notifications:
  slack:
    secure: j3t/N/O0YD1BZsiihdrw5yYLFtyYZgVPkxcCIr0yWEYRhk1OWw2RS/UcM+fjQjaRZMhSn+k6vFW5YXNMEPEDvVbuTt75Sj9Gy3YeSYmO6b9ZIUBDDkamBMMx1c2YUxZTZaL7gRaLF8H9+xz9MIMvsGeJAjSs0H8QtOMscWEO6n+Uko/HX/Sw/p/EpdnWBj6CBu+WKutmRM/4QVRVe+kJirLrx8Hux7ejCnxskdfbh/i/beq6Oy9PQEsBLLn2+kGWxXb2lurCdH/eQtnshIJLHO5ee0XDEyp+H1QFXKQnu//QIAAW5QcEU6hM0aP1j37n5J/uRsARf86e6iYSIvP3esvuKGBLnb9iqR/qx/aekqc8fIXmi8a5Slgor4m2W2RxHlTKijdwwzIzX1BFOV3hxJ3ZmeOs8j95OpesQfHS4tAxhbLowJvZT38pBm3rOwTWeotz1CE81Zs2ycnjVI93a5xG9VteXh4xOfrHgBqkOgaohrl9wQknc7x0W5xGe1ycf6o6pLln6nFs9MqgXjFH7XTOajQL+mChukA7iRFznnE97xMN4rrKiRzluZ4C8A6z0GXWyYuI2FQdg5mj8zh2S4NkuJvud3vHanCDHjVkRDVv5AIi7qMGgt2c1Cv/lqGZhwT1nXpSpgF5TsOtKOHfa54wzqnJiEucWacuwdQziHc=
  email:
    recipients:
    - mark.mcewen@capita.com
    on_success: never
    on_failure: always

services:
- docker

env:
  global:
  - FLASK_APP=todo_app/app FLASK_ENV=development
  - secure: EXav8MfB+psh+Fzm0gUjFWpR02490CB0lCGpReR2knuESkaf9nmy+R8obr31OlQHB0oX7ixocG8/KNpF7d9GiZtYt/RiO+1gAAWT0YOA/A3LQ5lnYA2I04h3JUWeUBK1KJwBdK88ca4i+mfJKYKoIeRliwkvuGTOmgQlQ19zwjej6NIFiA2taLbs2TZ4ZW9w0rw8WRx1W5VDJ4pjqCjXS9YBVGqqrWgh9/kXjkUc1RYyGBaTexi24vPG9JPRwyP/qtwoB19ThqCMiyi+HxA/9p50Jw7BAJIFYKBw8Saq0OF0VxCs3G8XT6y4AjUc77mD1d8UQ5Oovn8iLjISk5vy9R03gIK/nVLaSxqojmEzrUrdB9OTOJrUhCpc8Lq6oOTZfZnLLtlhDbkg+8mpJvqEwPxSMBEUDuVbDEsbcI2YcCgB/TxwOieo+67rqzq6sEtX5JxwQhP1ZiJ4E+srbhvZkGtI+pJyELs/1LZb42bn+cNWa4znKDvJcpireqQ1h5vel92rB60Axg/t3Mgqg0P3Jqg55Bf5zi4u3gqLaWESjc0n8NdavDgQ+iLVC7Dtdh2nPQ2k7pGHeiA/isxneo/nF9yCuvTqJvCjFsboAv1HQwX89SHiQGvqZV4nJDHTaH7evwMdb6gvuDw0BjeOhqumoDf0c09ZfO495dYbcI/oeiE=
  - secure: E0W1BgRZGThhXtIahakuP/k4aPPZdKF+hJUXd+25GOJdvabxuQmVaTltjbOoJKzqbmy8oVpHoAFW00VEVhKvTIK7O1SVqVYNjNtZhe2lxzlrTHKNYq6AlavhqjLucq9DqSBSHSNMelg2fAokhyauCLfH3YQy+C/nIwJZr+7RgpyjXehknBnrvFHvygUDW7QqNBKOXM+H6W8x7YyjAMgsf0bSUUQxeAk3daNmldjvg49C0J5Ac6uxjtM1kby4BrVYPlKz6M8cK7uFVIlc2JXS75MfYxIAl0t0EUekEfdsdMHJBYbZE/YcIzNhFvN58+v2rYnyQFarDqTGfXRgJhh1AknFJtYaQ/tZck8aBti9/LSndZJ8q+hb+K7yc+QWwQGSzd4patsHvp3KtsI7XnbArOCMccbtPl4yGixPpK4kgGAyjv/zykHsWpZnSDvd6taUs2xP9mdiUkUR7pFehwI0OmuRzTno+OQAW2oMO7NIifjVqaYh0KMAZYJk19PAd8iQlPqnT6nA6zLnuHOIadsTJi7DfrU950UIOoJYtE03ujgaLxq1y+3LgVlqsZT5Hs3p+9vV5BEYm3twPyTrlJqY7es9MTsvHIQu/aFmgG1btv8hmEJw/6hABHncnVPY+tIe/iVfGdZZ0DpQ/Hrjk2UmzZz3jpWHXd+LLIYMCnq1P/Y=
  - secure: XL7P2xovLrObNNqmWFNcQ+/PIlOJLbixFdqMzrNBm55lXENSwUGgYUeWqULsBWeTHbNknu1XwXDh9EHrziZuocb6ARc1LjAXBT7AzCdAHcvgZRYnnOucm1YWBQcYQJlcUsftVKByVfMyiTvKDw0qYoJZTnzEP5ykBASZvgM3gePcemcZnvAl0jrvSKNpsFwxZt/Yg5wn15COAqbjdKy/4ZXI2QBpZCOX5jHtUy5CGNyKQ9NynC9gcLjgKI1mohYDckTLNP1pdHQ14ecK2PkhOwu92ViRnvCfgNj7gZJSB3jb8JFyMtXZeLuekcJRusvzMI/umctpqHNgqonROTUgJcGyZzkFfXCe1U3SSPENChMW+L3AS/cm6wq7UxLqyyPm8b/6/btvhJE4Dkm/JZjK+d9rTMfRuinij7zlI7yGoP8Z7w3jUJfIMk8mJmJ+/xAueQ8r7YAvImDH4MKduvFgPucdu2jYRNOB7b2wx18c3xjqGz51g3yMhway0vSPwnsHppgmCjLj5FvFYhMFTEoDfQ5fZwhXWfzmTyfh1G7FkcZKcPXWB6WyTQzNJxM1H+TRUnkfiXkd2DIc5d/NSEhzPGOj2GQKT5aoR3xkS7KEpQXF7kzyfs4Abg3WIh7JkYMnONqXDFM4vsE+oQCTygIHiazhh+OG5HnRMqAdiOE2jhg=
  - secure: BS3qr9J4QGVZaI22gQUXOVc722/q8XNSgiply+A65QdsqXLPbgVa3NhxGyIyub3axI+MqyXaXLY1kkO8GOk05zZM3zSl//hvtc3yQKn4PIMOQwSzBJZBpjzwFCRPpyD7JNgHtoF2pya0u/WUqIrOMBRZSvl6/hMoZfTbzDwyxMwbSIHU3fhCwCYKgilKQ42t5hZXQaA4ZSqTyPZ93++AV1C3Y7RkOCzx5i6tIThfvJ/Ky3Xd14LUAmC4lZwBIHF/hjT9rP6oAJQagxEEfbyX+MQz7nTnhPfYrrf8BXcdx8sR9/7zlE+EuPLELzRk8Sy+OEHS6T8npLciSkAsdEey6K51vqTJ/fDyoWhlvTdID/qBJww1OcoRZi+OPUQtHo9kE5sYKADs0HoAXLDFmM4jF8Hd4QQ2ByuhDnGIDveYN9iNw0OQJGDZgbX0QBcvzbhKQN7OPCJkQvKqoixV3X8ejtUkGehBwZAGdhYkVmIeRYB/cSjSzSJx+tRJeOrLqjgUqmehWINIHzkk5qSMtVuhZeRIXDRpDmVYZdiEKFZWpAzAjkXMREDLBC32U4UbOMebrtK6Gz/PwlUQHXkAB4mOpaq3pecKCTvfVGDQMct9lyC6KMsb4EDFn6TPxTzQ4bOPZE6utz7iwQTvXrsFr6g37kzvwczBBkcJX9054OJAypc=
  - secure: NosVtWSmY4BAWBqbl+vQgoiT4/t+ORFpIN0l7qmenFHaCfuHcF41zF0FKkrgbT80gCbs5m2MlzCg4rtpMy+uSqpngCeky+GFs7aw2dG/vAe+KoNaT/do1C9D2tZMyJR2Socx7qr8D+8csrOPuH8MM8U4ygmIG9d/04Y4x8HXeI9K+3L/O2c8ds0WvvX+MAFFV1YV0yHtAoz9emh+dAVhl7kXZdMmUdlqeO/kHWfHUgzXDSUWFqhWVhbm3JL1HkK63OF5LfqctT+iQ8ZjluO9CxmqKA2hyKG16zUuTAB7Kigl6GCjr3MCveosDcXi3zqkiKVa8npWrJ0Z7PACtKrtiRO04+huXB5VrAybz5U3vryil6M3e0mPY8JUAjes5MUdFkz+saUK2SQyw9vaB2aXykX5vLMncnFqxCKQ7yIhpskuoXCh/8hMc+xLxnOZlc961HEO6sc9OgSQdYPXRGjNsfrqkOEDo1Kg8+Tbpe1KVrIvjgVb3LZxcG1x/1na8AHtKeU+4LWqguXyCygIBfG3DmccdEXtSpNNYkgusxy6PlaGdNAilG3WD3dzaN3754zA42hhejKRGItg3OuDEnSmnDn5gJoVNF3Grwr5u1jJdsQTZX8AZIM3Y+sqwKyPOrcZwONytBBLRFHxs1u7jEaMEIDarugWDiY6NZ9zQr7Rg/Y=
  - DOCKER_USERNAME=markmcdevops

jobs:
  include:
    - stage: Build docker images
      before_script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

      script:
      - docker build --target test --tag $DOCKER_USERNAME/todo-app:$TRAVIS_COMMIT-test .
      - docker push $DOCKER_USERNAME/todo-app:$TRAVIS_COMMIT-test

    - stage: Test
      script:
      - docker run -e SECRET_KEY -e TRELLO_KEY -e TRELLO_TOKEN -e TRELLO_BOARD_ID --mount
        type=bind,source="$(pwd)"/todo_app,target=/project/todo_app $DOCKER_USERNAME/todo-app:$TRAVIS_COMMIT-test

